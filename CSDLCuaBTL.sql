CREATE DATABASE PHANMEMTRACNGHIEM

USE PHANMEMTRACNGHIEM
GO 

CREATE TABLE TAIKHOAN(
	TenDangNhap varchar(30) PRIMARY KEY,
	MatKhau varchar(30) NOT NULL,
	LoaiTaiKhoan nvarchar(30)
)

CREATE TABLE GIANGVIEN(
	MaGV varchar(30) PRIMARY KEY,
	TenGV nvarchar(30) NOT NULL,
	TenDangNhap varchar(30) NOT NULL,
	FOREIGN KEY(TenDangNhap) REFERENCES TAIKHOAN(TenDangNhap) ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE LOP(
	MaLop varchar(30) PRIMARY KEY,
	TenLop nvarchar(30) NOT NULL,
	MaGV varchar(30) NOT NULL,
	SoSV int,
	FOREIGN KEY(MaGV) REFERENCES GIANGVIEN(MaGV) ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE SINHVIEN(
	MaSV varchar(30) PRIMARY KEY,
	TenSV nvarchar(30) NOT NULL,
	MaLop varchar(30) NOT NULL,
	TenDangNhap varchar(30) NOT NULL,
	FOREIGN KEY(MaLop) REFERENCES LOP(MaLop) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY(TenDangNhap) REFERENCES TAIKHOAN(TenDangNhap)
)

CREATE TABLE BAIKIEMTRA(
	MaBKT varchar(30) PRIMARY KEY,
	MaLop varchar(30) NOT NULL,
	TenBKT nvarchar(30) NOT NULL,
	DoKho nvarchar(30) NOT NULL,
	ThoiGianLam int NOT NULL,
	HanNop datetime,
	TongSoCau int,
	FOREIGN KEY(MaLop) REFERENCES LOP(MaLop) ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE CAUHOI(
	MaCH varchar(30) PRIMARY KEY,
	MaBKT varchar(30),
	NoiDung nvarchar(1000) NOT NULL,
	A nvarchar(1000) NOT NULL,
	B nvarchar(1000) NOT NULL,
	C nvarchar(1000) NOT NULL,
	D nvarchar(1000) NOT NULL,
	DapAn char,
	DoKho nvarchar(30) NOT NULL,
	FOREIGN KEY(MaBKT) REFERENCES BAIKIEMTRA(MaBKT) ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE CT_SV_BKT(
	MaSV varchar(30),
	MaBKT varchar(30),
	Diem float,
	SoCauDung int,
	TongThoiGianLam int,
	TrangThai nvarchar(30),
	FOREIGN KEY(MaSV) REFERENCES SINHVIEN(MaSV),
	FOREIGN KEY(MaBKT) REFERENCES BAIKIEMTRA(MaBKT) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY KEY(MaSV, MaBKT)
)
GO

INSERT INTO TAIKHOAN VALUES('Giang vien', '123456', N'Giảng viên')
INSERT INTO TAIKHOAN VALUES('Sinh vien 1', '123456', N'Sinh viên')
INSERT INTO TAIKHOAN VALUES('Sinh vien 2', '123456', N'Sinh viên')
INSERT INTO TAIKHOAN VALUES('sinh vien 3', '1234567', N'Sinh viên')

INSERT INTO GIANGVIEN VALUES('GV1', 'A', 'Giang vien')

INSERT INTO LOP VALUES('L1', 'CNTT1', 'GV1', 30)
INSERT INTO LOP VALUES('L2', 'CNTT2', 'GV1', 50)

INSERT INTO SINHVIEN VALUES('SV1', 'AA', 'L1', 'Sinh vien 1')
INSERT INTO SINHVIEN VALUES('SV2', 'BB', 'L2', 'Sinh vien 2')

INSERT INTO BAIKIEMTRA VALUES('BKT1', 'L1', 'So 1', N'Dễ', 50, '05-26-2021', 60)
INSERT INTO BAIKIEMTRA VALUES('BKT2', 'L2', 'So 1', N'Khó', 50, '05-27-2021', 60)

INSERT INTO CAUHOI VALUES('CH1', 'BKT1', 'AAAA', 'A', 'B', 'C', 'D', 'C', N'Dễ')
INSERT INTO CAUHOI VALUES('CH2', 'BKT1', 'AAAAA', 'A', 'B', 'C', 'D', 'D', N'Dễ')
INSERT INTO CAUHOI VALUES('CH3', 'BKT1', 'AAAAAA', 'A', 'B', 'C', 'D', 'A', N'Dễ')
INSERT INTO CAUHOI VALUES('CH4', 'BKT2', 'AAAAAAA', 'A', 'B', 'C', 'D', 'D', N'Khó')

INSERT INTO CT_SV_BKT VALUES('SV1', 'BKT1', 9, 45, 43, N'Hoàn thành')
INSERT INTO CT_SV_BKT VALUES('SV2', 'BKT2', 0, 0, 0, N'Chưa làm')
GO

SELECT *FROM TAIKHOAN
SELECT *FROM GIANGVIEN
SELECT *FROM LOP
SELECT *FROM SINHVIEN
SELECT *FROM BAIKIEMTRA
SELECT *FROM CAUHOI
SELECT *FROM CT_SV_BKT

SELECT * 
FROM dbo.[CT_SV_BKT] INNER JOIN dbo.[SINHVIEN] ON CT_SV_BKT.MaSV = SINHVIEN.MaSV  
INNER JOIN dbo.[BAIKIEMTRA] ON CT_SV_BKT.MaBKT = BAIKIEMTRA.MaBKT 
WHERE BAIKIEMTRA.MaBKT = 'BKT1'

SELECT * FROM TAIKHOAN WHERE TenDangNhap='Giang vien' and MatKhau='123456' and LoaiTaiKhoan=N'Giảng viên'


INSERT INTO BaiKiemTra(MaBKT, TenBKT, DoKho, ThoiGianLam, HanNop, TongSoCau, MaLop) VALUES('1', '1', 'Dễ', 50, '05-30-2021 15:30', 50, 'L1')

SELECT * FROM Lop INNER JOIN GIANGVIEN ON Lop.MaGV = GIANGVIEN.MaGV WHERE TenDangNhap = 'Giang vien'

SELECT * FROM dbo.[CT_SV_BKT] INNER JOIN dbo.[SINHVIEN] ON CT_SV_BKT.MaSV = SINHVIEN.MaSV  
                INNER JOIN dbo.[BAIKIEMTRA] ON CT_SV_BKT.MaBKT = BAIKIEMTRA.MaBKT 
                WHERE BAIKIEMTRA.MaLop= 'L1'

SELECT * FROM CT_SV_BKT INNER JOIN SINHVIEN ON SINHVIEN.MaSV = CT_SV_BKT.MaSV 
INNER JOIN BAIKIEMTRA ON CT_SV_BKT.MaBKT = BAIKIEMTRA.MaBKT
WHERE SINHVIEN.MaSV = 'SV1' AND BAIKIEMTRA.MaBKT ='BKT1'

UPDATE CT_SV_BKT 
SET Diem = 5, SoCauDung = 5, TongThoiGianLam = 29, TrangThai = 'Hoàn thành' 
WHERE MaSV ='SV1' AND MaBKT = 'BKT1'

UPDATE CT_SV_BKT
SET Diem = 4
WHERE MaSV ='SV1' AND MaBKT = 'BKT1'
